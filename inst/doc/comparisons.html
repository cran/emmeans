<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Russ Lenth" />

<meta name="date" content="2017-11-04" />

<title>Comparisons and contrasts in emmeans</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Comparisons and contrasts in emmeans</h1>
<h4 class="author"><em>Russ Lenth</em></h4>
<h4 class="date"><em>2017-11-04</em></h4>



<div id="contents" class="section level2">
<h2>Contents</h2>
<p>This vignette covers techniques for comparing EMMs at levels of a factor predictor, and other related analyses.</p>
<ol style="list-style-type: decimal">
<li><a href="#pairwise">Pairwise comparisons</a></li>
<li><a href="#contrasts">Other contrasts</a></li>
<li><a href="#formulas">Formula interface</a></li>
<li><a href="#linfcns">Custom contrasts and linear functions</a></li>
<li><a href="#logs">Special behavior with log transformations</a></li>
<li>Interaction contrasts (see <a href="interactions.html">“interactions” vignette</a>)</li>
</ol>
<p><a href="index.html">Vignette index</a></p>
</div>
<div id="pairwise" class="section level2">
<h2>Pairwise comparisons</h2>
<p>The most common follow-up analysis for models having factors as predictors is to compare the EMMs with one another. This may be done simply via the <code>pairs()</code> method for <code>emmGrid</code> objects. In the code below, we obtain the EMMs for <code>source</code> for the <code>pigs</code> data, and then compare the sources pairwise.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pigs.lm &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(conc) ~<span class="st"> </span>source +<span class="st"> </span><span class="kw">factor</span>(percent), <span class="dt">data =</span> pigs)
pigs.emmGrid.s &lt;-<span class="st"> </span><span class="kw">emmeans</span>(pigs.lm, <span class="st">&quot;source&quot;</span>)
<span class="kw">pairs</span>(pigs.emmGrid.s)
##  contrast      estimate         SE df t.ratio p.value
##  fish - soy  -0.2727678 0.05293450 23  -5.153  0.0001
##  fish - skim -0.4022777 0.05415929 23  -7.428  &lt;.0001
##  soy - skim  -0.1295098 0.05304280 23  -2.442  0.0570
## 
## Results are averaged over the levels of: percent 
## Results are given on the log (not the response) scale. 
## P value adjustment: tukey method for comparing a family of 3 estimates</code></pre></div>
<p>In its out-of-the-box configuration, <code>pairs()</code> sets two defaults for <a href="confidence-intervals.html#summary"><code>summary()</code></a>: <code>adjust = &quot;tukey&quot;</code> (multiplicity adjustment), and <code>infer = c(FALSE, TRUE)</code> (test statistics, not confidence intervals). You may override these, of course, by calling <code>summary()</code> on the result with different values for these.</p>
<p>In the example above, EMMs for later factor levels are subtracted from those for earlier levels; if you want the comparisons to go in the other direction, use <code>pairs(pigs.emmGrid.s, reverse = TRUE)</code>. Also, in multi-factor situations, you may specify <code>by</code> factor(s) to perform the comparisons separately at the levels of those factors.</p>
<p>Comparisons may be summarized graphically via the <code>comparisons</code> argument in <code>plot.emmGrid()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(pigs.emmGrid.s, <span class="dt">comparisons =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAbAAAACQCAMAAABeS86aAAAA5FBMVEUAAAAAADoAAEAAAGYAOpAAZrYzMzM6AAA6ADo6kNtNTU1NTW5NTY5NbqtNjshmAABmADpmtv9uTU1uTW5uTY5ubk1ubo5ubqtujo5ujshuq6tuq8huq+SOTU2OTW6OTY6Obk2ObquOjk2Ojo6OyP+QOgCQtpCQ27aQ2/+rbk2rbm6rbo6rjk2rq46ryKur5Mir5OSr5P+wsPC2ZgC2//+/v//Ijk3Ijm7I5KvI///bkDrb/7bb///kq27k5Kvk///r6+v/AAD/tmb/yI7/25D/29v/5Kv//7b//8j//9v//+T///8F/zWVAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAHeElEQVR4nO2dDV/qNhTGkatTcfc6mNvdC25zk03Z+7yyyWRe0FWg3//7LGnTl2D6ctqmSbrn/LzcQvqcnORP0gBJ0/NhTlnPdAAwmgGYYwZgjhmAOWYA5pgBmGNWC9h7buFjluWm1pBqc2xjTDwVwJqXApgJxzbGBGB6pABmwrGNMQGYHimAmXBsY0wApkcKYCYc2xgTgOmRApgJxzbGBGB6pABmwnFJ6R8qu1W+WibxZeputgBWT2oxsO30d/bond0BWBaw5bKISb/f54nL9oChhcmpEq5CYH1u4ak6gT0OBh/ecWDb69f/nN1tpz8PBmP24hjAEmDLZTGwfl8QS52rAdj66zt/8YYDm415l7i9fuN7ozeid/yAWWHr7K7dCltWsdsSlpVxHrCvgr5wO/1kHFzDeN/I/4nXfbSwai1M2cQa6RK90eCEMbr+4uIBwHZSU1VLu4ZlXMSaGnQ8vn5gjBZjANtJTddtMbB4lKh10MFgCWDsD8DkVLl2C4GJRM3D+lk0SmTt6y8Ak1LL1XrpRHzTYUKK7xJNOLYxJgDTIzUAbN7rDef79wBmn2MlsJv9v0+Hm8kBgNnnWAXs+XTI/vzVq3cAZp1jAGte2n6XOOdd4vPpcUleANaiYyUwf9VjVpoXgLXoWA2MaIbLYJsUwEw4tjGmTGCbybFPGNUDWIuOlcBuDgJq+BxmoWMVMD6mZ4ZhvY2OAax5qYHPYRwVPodZ6VgJDJ/D7IwJw3o90taBbSZDALMxpoJBR4eBNT/1QpqE0f6go/xvlx0AVnLOdHaq7EBzYdUtrBdYd4f1qVovnuQezv3MAya50FxYZQujWt1ADAIrXpUQzdbNBZbyobmwFGDhKhZ/fc7/m1363tsHx4Flz3GPkcTz4fOBJV40F1YFLKNLFKtY/NmYTwR+ZI98vZGTq1fqLDkpWovSUhFetrDnj67kF8RMX86NHa4vHv50duavhhZmQZe42h0rhqtY+LKwYJ79rxcPrgNr7BqWeqa5sHnAFKNE1heKFuYvvnN3BWa61hsYJUpJmgubA+xmp4WJVSziGuZ7H8drnusGgg/O5VNVwMSgY2/nGiZWsYhRor/9Mb6fQN1AAKx8ak4LKzDv8/iwbiA2fm9nY0y1gC1OkrtAGC6DbVIDwOb4PczGmDKB4RdnO2PKHnRgToeVMQGYHim6RBOObYwJgw49UjuH9QBmxjGANS9tH1iwBLP8DAEAa9GxEtjNAR93zLEYwkLHKmDP4S0EMKy30XEGMD6mBzAbHauAbSbHq72rcJUYgFnmWAXMfzrsHbz4/RLArHCsBEY1w2WwTQpgJhzbGJM2YNRf3Mv/HN9e5QDYS1vmJaak8jzolirHfWDb68Fn8T4e8o4eu1mVAiZm8/FJZEXApHnQLVWO+8AkRvWBiRmcwTTNYmARsfYqx3lg6/PByS8MU7giwjv7djC4rA4smiOtngitACaQtVc5zgPjjYr9iRUR3iicTapeDFG4P0XlxQaFUf5vrDSwcEUE7xKTbnH3vaGjhaFLfF+phaVWRNQBRr2GRcftVU5ngPnBJPv6wKJVCGVGiclxe5XTFWBiRUQTwEom4oOzlEpuYTMxSgQwM47LA8sxw2WwTQpgJhzbGBOA6ZECmAnHNsYEYHqkAGbCsY0xAZgeKYCZcGxjTACmRwpgJhzbGBOA6ZHaDyywGvd0q3M7ODPZmi8sgDkgBTDHpADmmLRZYLBWDcAcMwBzzADMMQMwx6w6MHE3e+mILOVrLS5zz83WLgbEfBPp9nqQuu0jRcozTU1WJ+XqjYj1pNJWBsbnTvG72aePyFKf1wAJWEo7o5HekYYTzulS368qDe5wTZGmteeXQlurS/QyliERpN6n3xDrPdJup6Q2kpbyhQIVpX58H3+ylG+oQc85pQ3yrQUsedORWlhKsJ3+RuwSY+36nNg3JVLv7U/ELtFPFZFc1sotLNE2AswbRYVOjqjSxZh6DYu1/HbsxFYWS0epDWRo0goNLJaytxiVV6QNusST2i0siZ1cilDAao0MTMqMeh2Ls60aMfEKJuXK3mGPxFFHnC0bdHw5rQ0sVV/UmgsF4ZhrXHhyw9muLyoAi/KakcMVUk6anmtSxPD6VxlYkj05EElAbGFytqlND0jZzohdYkpKHeskUnoLS7TB9S+4mlVvYax1iAVj4VElKf1zWCPZik0uKkmpbSSRPlIDlrVhV4xvOhwzAHPMAMwxAzDHDMAcMwBzzADMMQMwxwzAHDMAc8wAzDHrKLDNpMe3JHk6+v6w1zt+Yg9D+Ul0Br+TON/QKUwcmo672LoJjG9w4c/3758O9+/9eY8/vHonPYnOCDa5ixPLbztjzLoJbBXuXDd8OhzyNsQfjq6kJ9EZ//Kb9MeJR7tbWNtn3QQWbFzHuz9OIHqQnkRnMLjBXuNJouXWUWBid4scYOKM59O9KznRcusmML6FDLdsYNEZKw5uhRZm2DYTxkHCsAssOoODezoEMNPGB+1hX5cBLDrDv2H//cCGJwAG02IA5pgBmGMGYI4ZgDlmAOaYAZhj9h9+W1Wp60ocewAAAABJRU5ErkJggg==" /><!-- --></p>
<p>The blue bars are confidence intervals for the EMMs, and the red arrows are for the comparisons among them. If an arrow from one mean overlaps an arrow from another group, the difference is not significant, based on the <code>adjust</code> setting (which defaults to <code>&quot;tukey&quot;</code>). (Note: Don’t ever use confidence intervals for EMMs to perform comparisons; they can be very misleading.)</p>
<p>Another way to depict comparisons is by compact-letter displays:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cld</span>(pigs.emmGrid.s)
##  source   emmean         SE df lower.CL upper.CL .group
##  fish   3.394492 0.03668122 23 3.318612 3.470373  1    
##  soy    3.667260 0.03744798 23 3.589793 3.744727   2   
##  skim   3.796770 0.03938283 23 3.715300 3.878240   2   
## 
## Results are averaged over the levels of: percent 
## Results are given on the log (not the response) scale. 
## Confidence level used: 0.95 
## P value adjustment: tukey method for comparing a family of 3 estimates 
## significance level used: alpha = 0.05</code></pre></div>
<p>Two EMMs sharing one or more grouping symbols are not significantly different. I really don’t recommend this method, though, as it imposes a stark difference between <em>P</em> values slightly less and slightly more than <code>alpha</code>.</p>
<p><a href="#contents">Back to Contents</a></p>
</div>
<div id="contrasts" class="section level2">
<h2>Other contrasts</h2>
<p>Pairwise comparisons are an example of linear functions of EMMs. You may use <code>coef()</code> to see the coefficients of these linear functions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(<span class="kw">pairs</span>(pigs.emmGrid.s))
##      source c.1 c.2 c.3
## fish   fish   1   1   0
## soy     soy  -1   0   1
## skim   skim   0  -1  -1</code></pre></div>
<p>The pairwise comparisons correspond to columns of the above results. For example, the first pairwise comparison, <code>fish - soy</code>, gives coefficients of 1, -1, and 0 to fish, soy, and skim, respectively. In cases, such as this one, where each column of coefficients sums to zero, the linear functions are termed <em>contrasts</em></p>
<p>The <code>contrast()</code> function provides for general contrasts (and linear functions, as well) of factor levels. Its second argument, <code>method</code>, is used to specify what method is to be used. In this section we describe the built-in ones, where we simply provide the name of the built-in method. Consider, for example, the factor <code>percent</code> in the model <code>pigs.lm</code> . It is treated as a factor in the model, but it corresponds to equally-spaced values of a numeric variable. In such cases, users often want to compute orthogonal polynomial contrasts:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pigs.emmGrid.p &lt;-<span class="st"> </span><span class="kw">emmeans</span>(pigs.lm, <span class="st">&quot;percent&quot;</span>)
ply &lt;-<span class="st"> </span><span class="kw">contrast</span>(pigs.emmGrid.p, <span class="st">&quot;poly&quot;</span>)
ply
##  contrast     estimate         SE df t.ratio p.value
##  linear     0.93739228 0.21055597 23   4.452  0.0002
##  quadratic -0.09710425 0.08832632 23  -1.099  0.2830
##  cubic      0.18631573 0.18773559 23   0.992  0.3313
## 
## Results are averaged over the levels of: source 
## Results are given on the log (not the response) scale.

<span class="kw">coef</span>(ply)
##    percent c.1 c.2 c.3
## 9        9  -3   1  -1
## 12      12  -1  -1   3
## 15      15   1  -1  -3
## 18      18   3   1   1</code></pre></div>
<p>We obtain tests for the linear, quadratic, and cubic trends. The coefficients are those that can be found in tables in many experimental-design texts. It is important to understand that the estimated linear contrast is <em>not</em> the slope of a line fitted to the data. It is simply a contrast having coefficients that increase linearly. It <em>does</em> test the linear trend, however.</p>
<p>There are a number of other named contrast methods, for example <code>&quot;trt.vs.ctrl&quot;</code>, <code>&quot;eff&quot;</code>, and <code>&quot;consec&quot;</code>. The <code>&quot;pairwise&quot;</code> and <code>&quot;revpairwise&quot;</code> methods in <code>contrast()</code> are the same as <code>Pairs()</code> and <code>pairs(..., reverse = TRUE)</code>. See <a href="../html/emmc-functions.html">help(“contrast-methods”)</a> for details.</p>
<p><a href="#contents">Back to Contents</a></p>
</div>
<div id="formulas" class="section level2">
<h2>Formula interface</h2>
<p>If you already know what contrasts you will want before calling <code>emmeans()</code>, a quick way to get them is to specify the method as the left-hand side of the formula in its second argument. For example, with the <code>oranges</code> dataset provided in the package,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">org.aov &lt;-<span class="st"> </span><span class="kw">aov</span>(sales1 ~<span class="st"> </span>day +<span class="st"> </span><span class="kw">Error</span>(store), <span class="dt">data =</span> oranges,
               <span class="dt">contrasts =</span> <span class="kw">list</span>(<span class="dt">day =</span> <span class="st">&quot;contr.sum&quot;</span>))
org.emml &lt;-<span class="st"> </span><span class="kw">emmeans</span>(org.aov, consec ~<span class="st"> </span>day)
org.emml
## $emmeans
##  day    emmean       SE    df lower.CL upper.CL
##  1    7.872750 2.772162 29.24 2.205099 13.54040
##  2    7.100600 2.772162 29.24 1.432949 12.76825
##  3   13.758600 2.772162 29.24 8.090949 19.42625
##  4    8.042467 2.772162 29.24 2.374815 13.71012
##  5   12.924600 2.772162 29.24 7.256949 18.59225
##  6   11.603650 2.772162 29.24 5.935999 17.27130
## 
## Confidence level used: 0.95 
## 
## $contrasts
##  contrast  estimate       SE df t.ratio p.value
##  2 - 1    -0.772150 3.776875 25  -0.204  0.9997
##  3 - 2     6.658000 3.776875 25   1.763  0.3243
##  4 - 3    -5.716133 3.776875 25  -1.513  0.4682
##  5 - 4     4.882133 3.776875 25   1.293  0.6128
##  6 - 5    -1.320950 3.776875 25  -0.350  0.9965
## 
## P value adjustment: mvt method for 5 tests</code></pre></div>
<p>The contrasts shown are the day-to-day changes.</p>
<p>This two-sided formula technique is quite convenient, but it can also create confusion. For one thing, the result is not an <code>emmGrid</code> object anymore; it is a <code>list</code> of <code>emmGrid</code> objects, called an <code>emm_list</code>. You may need to be cognizant of that if you are to do further contrasts or other analyzes. For example if you want <code>&quot;eff&quot;</code> contrasts as well, you need to do <code>contrast(org.emml[[1]], &quot;eff&quot;)</code> or <code>contrast(org.emml, &quot;eff&quot;, which = 1)</code>.</p>
<p>Another issue is that it may be unclear which part of the results is affected by certain options. For example, if you were to add <code>adjust = &quot;bonf&quot;</code> to the <code>org.emmGrid</code> call above, would the Bonferroni adjustment be applied to the EMMs, or to the contrasts? (See the documentation if interested; but the best practice is to avoid such dilemmas.)</p>
<p><a href="#contents">Back to Contents</a></p>
</div>
<div id="linfcns" class="section level2">
<h2>Custom contrasts and linear functions</h2>
<p>The user may write a custom contrast function for use in <code>contrast()</code>. What’s needed is a function having the desired name with <code>&quot;.emmc&quot;</code> appended, that generates the needed coefficients as a list or data frame. The function should take a vector of levels as its first argument, and any optional parameters as additional arguments. For example, suppose we want to compare every third level of a treatment. The following function provides for this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">skip_comp.emmc &lt;-<span class="st"> </span>function(levels, <span class="dt">skip =</span> <span class="dv">1</span>, <span class="dt">reverse =</span> <span class="ot">FALSE</span>) {
    if((k &lt;-<span class="st"> </span><span class="kw">length</span>(levels)) &lt;<span class="st"> </span>skip +<span class="st"> </span><span class="dv">1</span>)
        <span class="kw">stop</span>(<span class="st">&quot;Need at least &quot;</span>, skip +<span class="st"> </span><span class="dv">1</span>, <span class="st">&quot; levels&quot;</span>)
    coef &lt;-<span class="st"> </span><span class="kw">data.frame</span>()
    coef &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">lapply</span>(<span class="kw">seq_len</span>(k -<span class="st"> </span>skip -<span class="st"> </span><span class="dv">1</span>), function(i) {
        sgn &lt;-<span class="st"> </span><span class="kw">ifelse</span>(reverse, -<span class="dv">1</span>, <span class="dv">1</span>)
        sgn *<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">0</span>, i -<span class="st"> </span><span class="dv">1</span>), <span class="dv">1</span>, <span class="kw">rep</span>(<span class="dv">0</span>, skip), -<span class="dv">1</span>, <span class="kw">rep</span>(<span class="dv">0</span>, k -<span class="st"> </span>i -<span class="st"> </span>skip -<span class="st"> </span><span class="dv">1</span>))
    }))
    <span class="kw">names</span>(coef) &lt;-<span class="st"> </span><span class="kw">sapply</span>(coef, function(x)
        <span class="kw">paste</span>(<span class="kw">which</span>(x ==<span class="st"> </span><span class="dv">1</span>), <span class="st">&quot;-&quot;</span>, <span class="kw">which</span>(x ==<span class="st"> </span>-<span class="dv">1</span>)))
    <span class="kw">attr</span>(coef, <span class="st">&quot;adjust&quot;</span>) =<span class="st"> &quot;fdr&quot;</span>   <span class="co"># default adjustment method</span>
    coef
}</code></pre></div>
<p>To test it, try 5 levels:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">skip_comp.emmc</span>(<span class="dv">1</span>:<span class="dv">5</span>)
##   1 - 3 2 - 4 3 - 5
## 1     1     0     0
## 2     0     1     0
## 3    -1     0     1
## 4     0    -1     0
## 5     0     0    -1

<span class="kw">skip_comp.emmc</span>(<span class="dv">1</span>:<span class="dv">5</span>, <span class="dt">skip =</span> <span class="dv">0</span>, <span class="dt">reverse =</span> <span class="ot">TRUE</span>)
##   2 - 1 3 - 2 4 - 3 5 - 4
## 1    -1     0     0     0
## 2     1    -1     0     0
## 3     0     1    -1     0
## 4     0     0     1    -1
## 5     0     0     0     1</code></pre></div>
<p>(The latter is the same as <code>&quot;consec&quot;</code> contrasts.) Now try it with the <code>oranges</code> example we had previously:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">contrast</span>(org.emml[[<span class="dv">1</span>]], <span class="st">&quot;skip_comp&quot;</span>, <span class="dt">skip =</span> <span class="dv">2</span>, <span class="dt">reverse =</span> <span class="ot">TRUE</span>)
##  contrast   estimate       SE df t.ratio p.value
##  4 - 1     0.1697167 3.776875 25   0.045  0.9645
##  5 - 2     5.8240000 3.776875 25   1.542  0.4069
##  6 - 3    -2.1549500 3.776875 25  -0.571  0.8601
## 
## P value adjustment: fdr method for 3 tests</code></pre></div>
<p>The <code>contrast()</code> function may in fact be used to compute arbitrary linear functions of EMMs. Suppose for some reason we want to estimate the quantities <span class="math inline">\(\lambda_1 = \mu_1+2\mu_2-7\)</span> and <span class="math inline">\(\lambda_2 = 3\mu_2-2\mu_3+1\)</span>, where the <span class="math inline">\(\mu_j\)</span> are the population values of the <code>source</code> EMMs in the <code>pigs</code> example. This may be done by providing the coefficients in a list, and the added constants in the <code>offset</code> argument:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">LF &lt;-<span class="st"> </span><span class="kw">contrast</span>(pigs.emmGrid.s, 
               <span class="kw">list</span>(<span class="dt">lambda1 =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">0</span>), <span class="dt">lambda2 =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">3</span>, -<span class="dv">2</span>)),
               <span class="dt">offset =</span> <span class="kw">c</span>(-<span class="dv">7</span>, <span class="dv">1</span>))
<span class="kw">confint</span>(LF, <span class="dt">adjust =</span> <span class="st">&quot;bonferroni&quot;</span>)
##  contrast estimate         SE df lower.CL upper.CL
##  lambda1  3.729013 0.08274372 23 3.530604 3.927422
##  lambda2  4.408241 0.13411290 23 4.086655 4.729827
## 
## Results are averaged over the levels of: percent 
## Confidence level used: 0.95 
## Conf-level adjustment: bonferroni method for 2 estimates</code></pre></div>
<p><a href="#contents">Back to Contents</a></p>
</div>
<div id="logs" class="section level2">
<h2>Special properties of log (and logit) transformations</h2>
<p>Suppose we obtain EMMs for a model having a response transformation or link function. In most cases, when we compute contrasts of those EMMs, there is no natural way to express those contrasts on anything other than the transformed scale. For example, in a model fitted using <code>glm()</code> with the <code>gamma()</code> family, the default link function is the inverse. Predictions on such a model are estimates of <span class="math inline">\(1/\mu_j\)</span> for various <span class="math inline">\(j\)</span>. Comparisons of predictions will be estimates of <span class="math inline">\(1/\mu_j - 1/\mu_{k}\)</span> for <span class="math inline">\(j \ne k\)</span>. There is no natural way to back-transform these differences to some other interpretable scale.</p>
<p>However, logs are an exception, in that <span class="math inline">\(\log\mu_j - \log\mu_k = \log(\mu_j/\mu_k)\)</span>. Accordingly, when <code>contrast()</code> (or <code>pairs()</code>) notices that the response is on the log scale, it back-transforms contrasts to ratios when results are to be of <code>response</code> type. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pairs</span>(pigs.emmGrid.s, <span class="dt">type =</span> <span class="st">&quot;lp&quot;</span>)
##  contrast      estimate         SE df t.ratio p.value
##  fish - soy  -0.2727678 0.05293450 23  -5.153  0.0001
##  fish - skim -0.4022777 0.05415929 23  -7.428  &lt;.0001
##  soy - skim  -0.1295098 0.05304280 23  -2.442  0.0570
## 
## Results are averaged over the levels of: percent 
## Results are given on the log (not the response) scale. 
## P value adjustment: tukey method for comparing a family of 3 estimates

<span class="kw">pairs</span>(pigs.emmGrid.s, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)
##  contrast        ratio         SE df t.ratio p.value
##  fish / soy  0.7612695 0.04029742 23  -5.153  0.0001
##  fish / skim 0.6687950 0.03622146 23  -7.428  &lt;.0001
##  soy / skim  0.8785259 0.04659947 23  -2.442  0.0570
## 
## Results are averaged over the levels of: percent 
## P value adjustment: tukey method for comparing a family of 3 estimates 
## Tests are performed on the log scale</code></pre></div>
<p>As is true of EMM summaries with <code>type = &quot;response&quot;</code>, the tests and confidence intervals are done before back-transforming. The ratios estimated here are actually ratios of <em>geometric</em> means. In general, a model with a log response is in fact a model for <em>relative</em> effects of any of its linear predictors, and this back-transformation to ratios goes hand-in-hand with that.</p>
<p>In generalized linear models, this behaviors will occur in two common cases: Poisson or count regression, for which the usual link is the log; and logistic regression, because logits are logs of odds ratios.</p>
<p><a href="#contents">Back to Contents</a></p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
